# MFace 工具集介绍

`MFace` 是一个为 Maya 设计的综合性面部绑定工具集，旨在提供高效、灵活且数据驱动的面部绑定工作流程。它涵盖了从初始拟合、绑定构建到姿势管理、Blend Shape 和权重处理的各个方面，并提供了强大的预设系统以提高工作效率。

## 主要功能模块

### 1. 核心工具与基础 (Core Tools & Foundation)
*   **`core.py`**: 提供了绑定系统的核心实用程序和基类，包括对 Maya 属性 (`Attr`)、节点 (`Node`) 的封装，以及用于复杂绑定逻辑的表达式 (`Exp`) 和约束 (`Cons`) 工具。它还包含一个 `Hierarchy` 类，用于管理 Maya 节点层次结构。
*   **`node.py`**: 提供了更基础的 Maya 节点和属性操作，是 `core.py` 的底层支持。
*   **`data.py`**: 专注于数据处理，特别是几何体和矩阵相关的操作，如从曲线获取点、向量/矩阵运算、创建 `follicle` 节点以及计算样条权重。

### 2. 拟合与构建 (Fitting & Building)
*   **`fits.py`**: 管理“拟合”对象，这些对象作为构建绑定的指南或模板。它支持创建关节、曲线、曲面、翻滚和 FK 等多种类型的拟合对象，并存储其相关数据。
*   **`rigs` (目录)**: 包含实际的绑定构建逻辑，根据 `fits` 数据生成 Maya 绑定元素（关节、控制器、簇、约束等）。
*   **`tools.py`**: 作为高级接口，整合了其他模块的功能，并为主要操作添加了撤销功能，简化了绑定构建、编辑和镜像等操作。

### 3. 姿势管理 (Pose Management)
*   **`facs.py`**: 处理面部动画控制系统 (FACS) 相关功能，特别是驱动关键帧 (SDK) 和姿势管理。它支持根据控制器属性值添加 SDK、创建组合目标 (`_COMB_`) 和中间目标 (`_IB`)，以及设置、重置、编辑和镜像姿势。
*   **`preset.py`**: 提供了保存和加载面部姿势数据（SDK、附加关节、Blend Shape）的功能，方便姿势的复用和管理。

### 4. Blend Shape 管理 (Blend Shape Management)
*   **`bs.py`**: 专注于 Blend Shape 操作，提供了查找、创建、重建、添加、镜像、编辑和删除 Blend Shape 目标的功能。它还支持将 Blend Shape 目标连接到驱动属性，并管理“复制编辑”模式以进行交互式雕刻。
*   **`preset.py`**: 支持 Blend Shape 数据的保存和加载。

### 5. 权重处理 (Weighting Tools)
*   **`wts.py`**: 专注于蒙皮权重操作，包��获取和设置蒙皮权重、获取关节数据、在网格之间复制点以及保存和加载蒙皮权重数据。
*   **`bs.py`**: 也包含一些与 Blend Shape 权重相关的操作。
*   **`preset.py`**: 支持簇权重和蒙皮权重的保存和加载。

### 6. 控制器管理 (Controller Management)
*   **`control.py`**: 定义了 `Control` 类，用于创建、修改和管理 Maya 控制器，包括设置其变换、父对象、名称、形状、颜色、半径、旋转、偏移、锁定属性和输出连接。
*   **`preset.py`**: 支持控制器形状的保存和加载。

### 7. 辅助功能 (Auxiliary Features)
*   **`fastPin.py`**: 用于在网格上创建“图钉”，这些图钉是跟随网格变形的定位器或控制器，并根据顶点接近度和 Blend Shape/蒙皮簇数据计算权重。
*   **`preset.py`**: 提供了全面的预设系统，允许用户保存和加载绑定各个方面的配置，包括拟合、姿势、权重和控制器，极大地提高了工作效率和一致性。它还支持为拟合预设创建 UI 按钮对象和生成预览图。
*   **`test.py`**: 包含了工具集中各个组件的测试函数，用于验证功能的正确性。

## 总结

`MFace` 工具集通过模块化的设计和丰富的功能，为 Maya 中的面部绑���提供了强大的支持。它强调数据驱动和自动化，旨在简化复杂的面部绑定流程，提高绑定师的工作效率和最终效果的质量。无论是创建基础绑定、管理复杂的面部姿势，还是处理 Blend Shape 和权重，`MFace` 都提供了全面的解决方案。
